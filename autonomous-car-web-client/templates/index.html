{% extends "layout.html" %}
{% block body %}
<script type="text/javascript">
  $(function() {
    var submit_form = function(keyCode) {
      $.getJSON($SCRIPT_ROOT + '/_add_numbers', {
        key: keyCode,
      }, function(data) {
        $('#result').text(data.result);
        $('input[name=a]').focus().select();
      });
      return false;
    };

    var pressedKeys = [];
    var indexPos = 40;
    var lastKey = 0;
    var key = 0;

    $(document.body).keydown(function (evt) {
        lastKey = key;
        pressedKeys[indexPos - evt.keyCode] = true;
        //Wait 25ms in case of complex order
        key = setTimeout(function(){}, 25);
        key = getKeyPress();
        console.log(key);
        
        if(lastKey != key){
            submit_form(key, 0);
        }
    });

    $(document.body).keyup(function (evt) {
        pressedKeys[indexPos - evt.keyCode] = false;
        //Wait 25ms in case of complex order
        key = setTimeout(function(){}, 25);
        key = getKeyPress();
        console.log(key);
        submit_form(key, 0);
    });

    function getKeyPress(){
        //Complex orders
        if(pressedKeys[2] && pressedKeys[1]){
            console.log('Forward right');
            return 6;
        }
        else if(pressedKeys[2] && pressedKeys[3]){
            console.log('Forward left');
            return 7;
        }
        else if(pressedKeys[0] && pressedKeys[1]){
            console.log('Reverse Right');
            return 8;
        }
        else if(pressedKeys[0] && pressedKeys[3]){
            console.log('Reverse left');
            return 9;
        }

        //Simple orders
        else if(pressedKeys[2]){
            console.log('Forward');
            return 1;
        }
        else if(pressedKeys[0]){
            console.log('Reverse');
            return 2;
        }
        else if(pressedKeys[1]){
            console.log('Right');
            return 3;
        }
        else if(pressedKeys[3]){
            console.log('Left');
            return 4;
        }
        else{
            console.log('None');
            return 0;
        }
    }
  });
</script>
<h1>jQuery Example</h1>
<p>
  <input type="text" size="5" name="a">
  <span id="result"></span>
  <ul id="log">
      
  </ul>
<p><a href=# id="calculate">calculate server side</a>
{% endblock %}